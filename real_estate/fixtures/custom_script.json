[
 {
  "docstatus": 0, 
  "doctype": "Custom Script", 
  "dt": "Customer", 
  "modified": "2018-09-26 12:15:54.514005", 
  "name": "Customer-Client", 
  "script": "frappe.ui.form.on(\"Customer\", {\n    onload: function (frm) {\n        if (frappe.get_prev_route()[1] == \"Lead\") {\n            frm.set_value('customer_type', 'Client')\n        }\n    },\n    onload_post_render: function (frm) {\n\t\n        frm.clear_custom_buttons()\n        frm.dashboard.hide()\n    },\n    refresh: function (frm) {\n        frm.clear_custom_buttons()\n        frm.dashboard.hide()\n    },\n});", 
  "script_type": "Client"
 }, 
 {
  "docstatus": 0, 
  "doctype": "Custom Script", 
  "dt": "Lead", 
  "modified": "2018-09-26 12:15:29.967863", 
  "name": "Lead-Client", 
  "script": "frappe.ui.form.on(\"Lead\", {\n    onload_post_render: function (frm) {\n        frm.dashboard.hide()\n    },\n    search: function (frm) {\n        var filter = {}\n\n        var arr_filter=[]\n\n        if (frm.doc.property_type) {\n            filter['property_type'] = [\"=\", frm.doc.property_type]\n            arr_filter.push(['property_type','=',frm.doc.property_type])\n        }\n        if (frm.doc.city) {\n            filter['city'] = [\"like\", frm.doc.city]\n            arr_filter.push(['city','like', \"%\"+frm.doc.city+ \"%\"])\n        }\n        if (frm.doc.purpose) {\n            filter[\"property_status\"] = [\"in\", [frm.doc.purpose, \"\u00c0 louer et \u00e0 vendre\"]]\n            arr_filter.push(['property_status','in',[frm.doc.purpose, \"\u00c0 louer et \u00e0 vendre\"]])\n        }\n        if (frm.doc.purpose) {\n            if (frm.doc.purpose == 'A louer') {\n                if ((frm.doc.price_from) && (frm.doc.price_to) ){\n                    filter[\"Property.rent_price\"] = [\">=\", frm.doc.price_from]\n                    filter[\"rent_price\"] = [\"<=\", frm.doc.price_to]\n\n                arr_filter.push(['rent_price','>=',frm.doc.price_from])\n                arr_filter.push(['rent_price','<=',frm.doc.price_to])\n                }\n                if (frm.doc.price_from && !frm.doc.price_to) {\n                    filter[\"rent_price\"] = [\">=\", frm.doc.price_from]\n                    arr_filter.push(['rent_price','>=',frm.doc.price_from])\n                }\n                if (!frm.doc.price_from && frm.doc.price_to) {\n                    filter[\"rent_price\"] = [\"<=\", frm.doc.price_to]\n                    arr_filter.push(['rent_price','<=',frm.doc.price_to])\n                }\n\n            } else if (frm.doc.purpose == '\u00c0 vendre') {\n                if ((frm.doc.price_from) && (frm.doc.price_to) ) {\n                    filter[\"Property.sale_price\"] = [\">=\", frm.doc.price_from]\n                    filter[\"sale_price\"] = [\"<=\", frm.doc.price_to]\n\n                    arr_filter.push(['sale_price','>=',frm.doc.price_from])\n                    arr_filter.push(['sale_price','<=',frm.doc.price_to])\n                }\n                if (frm.doc.price_from && !frm.doc.price_to) {\n                    filter[\"sale_price\"] = [\">=\", frm.doc.price_from]\n\n                    arr_filter.push(['sale_price','>=',frm.doc.price_from])\n                }\n                if (!frm.doc.price_from && frm.doc.price_to) {\n                    filter[\"sale_price\"] = [\"<=\", frm.doc.price_to]\n                    arr_filter.push(['sale_price','<=',frm.doc.price_to])\n                }\n            }\n        }\n        if (frm.doc.baths) {\n            filter['baths'] = [\">=\", frm.doc.baths]\n            arr_filter.push(['baths','>=',frm.doc.baths])\n        }\n        if (frm.doc.rooms) {\n            filter['rooms'] = [\">=\", frm.doc.rooms]\n            arr_filter.push(['rooms','>=',frm.doc.rooms])\n        }\n        if (frm.doc.size_sq_mt) {\n            filter['size_sq_mt'] = [\">=\", frm.doc.size_sq_mt]\n            arr_filter.push(['size_sq_mt','>=',frm.doc.size_sq_mt])\n        }\n        if (frm.doc.year_built) {\n            filter['year_built'] = [\">=\", frm.doc.year_built]\n            arr_filter.push(['year_built','>=',frm.doc.year_built])\n        }\n        if (frm.doc.furnished) {\n            filter['furnished'] = [\"=\", frm.doc.furnished]\n            arr_filter.push(['furnished','=',frm.doc.furnished])\n\n        }\n        \n        frappe.call({\n            method: \"frappe.client.get_list\",\n            args: {\n                doctype: \"Property\",\n                filters: arr_filter,\n                fields: [\"property_name\"]\n            },\n        }).then(function (r) {\n            if (r.message) {\n                frappe.confirm(\n                    \"R\u00e9sultats correspondant \u00e0 <b>\" + r.message.length + \"</b> propri\u00e9t\u00e9s\"+\"<br /> Voulez-vous aller \u00e0 la liste?\",\n                    function () {\n                           console.log(filter)\n                        frappe.route_options = filter\n                        frappe.set_route(\"List\", \"Property\");\n                    },\n                    function () {\n                        window.close();\n                    }\n                )\n            }else{\n                show_alert('Aucune propri\u00e9t\u00e9 trouv\u00e9e correspondant \u00e0 ce crit\u00e8re', 4);\n            }\n        });\n    }\n});", 
  "script_type": "Client"
 }
]